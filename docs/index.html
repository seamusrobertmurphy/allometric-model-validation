<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Seamus Murphy">
<meta name="dcterms.date" content="2024-11-05">
<meta name="keywords" content="REDD+, VCS, Verra, Carbon verification">

<title>VM0010 Starter Template</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-722b7ecd703fa194e825a0d619ad685e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-05471e2d35c82c0b78e5a6b25c716131.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint/kePrint.js"></script>
<link href="site_libs/lightable/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">VM0010 Starter Template</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">VM0010 Starter Template</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="4">
    <h2 id="toc-title"><strong>Contents</strong></h2>
   
  <ul>
  <li><a href="#preprocess-data" id="toc-preprocess-data" class="nav-link active" data-scroll-target="#preprocess-data">1. Preprocess data</a>
  <ul>
  <li><a href="#sec-1.1" id="toc-sec-1.1" class="nav-link" data-scroll-target="#sec-1.1">Import dummy data</a></li>
  <li><a href="#sec-1.2" id="toc-sec-1.2" class="nav-link" data-scroll-target="#sec-1.2">Review dummy data</a></li>
  <li><a href="#sec-1.3" id="toc-sec-1.3" class="nav-link" data-scroll-target="#sec-1.3">Tidy dummy data</a></li>
  </ul></li>
  <li><a href="#compute-equations" id="toc-compute-equations" class="nav-link" data-scroll-target="#compute-equations">2. Compute Equations</a>
  <ul>
  <li><a href="#eq1-plot-biomass" id="toc-eq1-plot-biomass" class="nav-link" data-scroll-target="#eq1-plot-biomass">EQ1: Plot biomass</a></li>
  <li><a href="#eq2-strata-biomass" id="toc-eq2-strata-biomass" class="nav-link" data-scroll-target="#eq2-strata-biomass">EQ2: Strata biomass</a></li>
  <li><a href="#eq3-harvest-carbon" id="toc-eq3-harvest-carbon" class="nav-link" data-scroll-target="#eq3-harvest-carbon">EQ3: Harvest carbon</a></li>
  <li><a href="#eq4-extracted-carbon" id="toc-eq4-extracted-carbon" class="nav-link" data-scroll-target="#eq4-extracted-carbon">EQ4: Extracted carbon</a></li>
  <li><a href="#eq5-slash-carbon" id="toc-eq5-slash-carbon" class="nav-link" data-scroll-target="#eq5-slash-carbon">EQ5: Slash carbon</a></li>
  <li><a href="#eq6-damaged-carbon" id="toc-eq6-damaged-carbon" class="nav-link" data-scroll-target="#eq6-damaged-carbon">EQ6: Damaged carbon</a></li>
  <li><a href="#eq7-undamaged-carbon" id="toc-eq7-undamaged-carbon" class="nav-link" data-scroll-target="#eq7-undamaged-carbon">EQ7: Undamaged carbon</a></li>
  <li><a href="#eq8-wood-products" id="toc-eq8-wood-products" class="nav-link" data-scroll-target="#eq8-wood-products">EQ8: Wood products</a></li>
  <li><a href="#eq9-hwp-carbon-loss-year-0" id="toc-eq9-hwp-carbon-loss-year-0" class="nav-link" data-scroll-target="#eq9-hwp-carbon-loss-year-0">EQ9: HWP carbon loss <sup>year-0</sup></a></li>
  <li><a href="#eq10-hwp-carbon-store" id="toc-eq10-hwp-carbon-store" class="nav-link" data-scroll-target="#eq10-hwp-carbon-store">EQ10: HWP carbon store</a></li>
  <li><a href="#eq11-hwp-carbon-loss-year-100" id="toc-eq11-hwp-carbon-loss-year-100" class="nav-link" data-scroll-target="#eq11-hwp-carbon-loss-year-100">EQ11: HWP carbon loss <sup>year-100</sup></a></li>
  <li><a href="#eq12-fuel-emissions" id="toc-eq12-fuel-emissions" class="nav-link" data-scroll-target="#eq12-fuel-emissions">EQ12: Fuel emissions</a></li>
  <li><a href="#eq13-harvesting-fuel-emissions" id="toc-eq13-harvesting-fuel-emissions" class="nav-link" data-scroll-target="#eq13-harvesting-fuel-emissions">EQ13: Harvesting fuel emissions</a></li>
  <li><a href="#eq14-hauling-fuel-emissions" id="toc-eq14-hauling-fuel-emissions" class="nav-link" data-scroll-target="#eq14-hauling-fuel-emissions">EQ14: Hauling fuel emissions</a></li>
  <li><a href="#eq15-transport-fuel-emissions" id="toc-eq15-transport-fuel-emissions" class="nav-link" data-scroll-target="#eq15-transport-fuel-emissions">EQ15: Transport fuel emissions</a></li>
  </ul></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul>
  <li><a href="#a.1-datamaid-audit" id="toc-a.1-datamaid-audit" class="nav-link" data-scroll-target="#a.1-datamaid-audit">A.1 DataMaid audit</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">VM0010 Starter Template</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Seamus Murphy, PhD <a href="mailto:seamusrobertmurphy@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-1792-0351" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    <p>The following workflow provides a starter script for quantifying greenhouse gas emissions reduction of projects designed under the <a href="https://verra.org/wp-content/uploads/2024/10/VM0010_IFM_LtPF_v1.4_Clean_10282024.pdf">VM0010 VCS Methodology, V1.4</a>.</p>
  </div>
</div>

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>REDD+, VCS, Verra, Carbon verification</p>
  </div>
</div>

</header>


<div class="cell">
<style type="text/css">
div.column {
    display: inline-block;
    vertical-align: top;
    width: 50%;
}

#TOC::before {
  content: "";
  display: block;
  height:200px;
  width: 200px;
  background-size: contain;
  background-position: 50% 50%;
  padding-top: 80px !important;
  background-repeat: no-repeat;
}
</style>
</div>
<section id="preprocess-data" class="level1">
<h1>1. Preprocess data</h1>
<section id="sec-1.1" class="level4">
<h4 class="anchored" data-anchor-id="sec-1.1">Import dummy data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">333</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>dataset_raw <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"./R/assets/dataset_raw.xlsx"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(dataset_raw, <span class="st">"./R/assets/dataset_tidy.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>dataset_tidy <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./R/assets/dataset_tidy.csv"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>dataset_tidy <span class="sc">|&gt;</span> <span class="fu">kbl</span>() <span class="sc">|&gt;</span> <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Stratum...i.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Plot..sp.</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Species..j.</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tree..l.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Volume..V_.l.j.I.sp..</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: left;">t1</td>
<td style="text-align: right;">3.30</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: left;">t2</td>
<td style="text-align: right;">4.80</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: left;">t3</td>
<td style="text-align: right;">4.08</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: left;">t1</td>
<td style="text-align: right;">1.50</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: left;">t2</td>
<td style="text-align: right;">1.68</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: left;">t1</td>
<td style="text-align: right;">1.38</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp2</td>
<td style="text-align: left;">t2</td>
<td style="text-align: right;">3.24</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp3</td>
<td style="text-align: left;">t3</td>
<td style="text-align: right;">3.72</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">sp4</td>
<td style="text-align: left;">t4</td>
<td style="text-align: right;">2.94</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp5</td>
<td style="text-align: left;">t5</td>
<td style="text-align: right;">3.36</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="sec-1.2" class="level4">
<h4 class="anchored" data-anchor-id="sec-1.2">Review dummy data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dataset_tidy)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(dataset_tidy, Species..j.)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">saveHTML</span>(dataMaid<span class="sc">::</span><span class="fu">makeDataReport</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  dataset_tidy,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"html"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">codebook =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">onlyProblematic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">visuals =</span> <span class="fu">setVisuals</span>(<span class="at">all =</span> <span class="st">"basicVisual"</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>) <span class="co"># output "dataMaid_dataset_tidy.html" shown in Appendix A.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   10 obs. of  5 variables:
 $ Stratum...i.         : int  1 1 1 1 1 2 2 2 2 2
 $ Plot..sp.            : int  1 1 1 2 2 1 1 1 1 1
 $ Species..j.          : chr  "Sp1" "Sp1" "Sp1" "Sp4" ...
 $ Tree..l.             : chr  "t1" "t2" "t3" "t1" ...
 $ Volume..V_.l.j.I.sp..: num  3.3 4.8 4.08 1.5 1.68 1.38 3.24 3.72 2.94 3.36</code></pre>
</div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Species..j.</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sp2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sp3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sp5</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">sp4</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="sec-1.3" class="level4">
<h4 class="anchored" data-anchor-id="sec-1.3">Tidy dummy data</h4>
<p>Clean dataset and relabel to match <a href="https://verra.org/wp-content/uploads/2018/03/VM0010-Methodology-for-IMF-LtPF-v1.3_0.pdf">VM0010 Verra Methodology</a> and <a href="https://style.tidyverse.org/">Tidyverse style guide</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setnames</span>(dataset_tidy, <span class="at">old =</span> <span class="st">"Stratum...i."</span>, <span class="at">new =</span> <span class="st">"stratum_i"</span>, <span class="at">skip_absent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setnames</span>(dataset_tidy, <span class="at">old =</span> <span class="st">"Species..j."</span>, <span class="at">new =</span> <span class="st">"species_j"</span>, <span class="at">skip_absent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setnames</span>(dataset_tidy, <span class="at">old =</span> <span class="st">"Plot..sp."</span>, <span class="at">new =</span> <span class="st">"plot_sp"</span>, <span class="at">skip_absent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setnames</span>(dataset_tidy, <span class="at">old =</span> <span class="st">"Tree..l."</span>, <span class="at">new =</span> <span class="st">"tree_l"</span>, <span class="at">skip_absent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setnames</span>(dataset_tidy, <span class="at">old =</span> <span class="st">"Volume..V_.l.j.I.sp.."</span>, <span class="at">new =</span> <span class="st">"volume"</span>, <span class="at">skip_absent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>dataset_tidy<span class="sc">$</span>species_j[dataset_tidy<span class="sc">$</span>species_j <span class="sc">==</span> <span class="st">"sp4"</span>] <span class="ot">&lt;-</span> <span class="st">"Sp4"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>dataset_tidy<span class="sc">$</span>species_j  <span class="ot">=</span> <span class="fu">as.factor</span>(dataset_tidy<span class="sc">$</span>species_j)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>dataset_tidy<span class="sc">$</span>stratum_i  <span class="ot">=</span> <span class="fu">as.factor</span>(dataset_tidy<span class="sc">$</span>stratum_i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compute new variables &amp; save copy of cleaned <code>dataset_tidy.csv</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dataset_tidy<span class="sc">$</span>bcef_r     <span class="ot">=</span> <span class="fl">0.7</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dataset_tidy<span class="sc">$</span>cf         <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>dataset_tidy<span class="sc">$</span>d          <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>dataset_tidy<span class="sc">$</span>a_sp       <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>dataset_tidy<span class="sc">$</span>a_sp_m2    <span class="ot">=</span> dataset_tidy<span class="sc">$</span>a_sp <span class="sc">*</span> <span class="dv">10000</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>dataset_tidy <span class="ot">=</span> dataset_tidy <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stratum_i) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a_I_m2 =</span> <span class="fu">sum</span>(a_sp_m2), <span class="at">a_I_ha =</span> <span class="fu">sum</span>(a_sp)) </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(dataset_tidy, <span class="st">"./R/assets/dataset_tidy.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>dataset_tidy <span class="sc">|&gt;</span> <span class="fu">kbl</span>() <span class="sc">|&gt;</span> <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">stratum_i</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">plot_sp</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">species_j</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">tree_l</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">volume</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">bcef_r</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cf</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">a_sp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">a_sp_m2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">a_I_m2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">a_I_ha</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: left;">t1</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">5000</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: left;">t2</td>
<td style="text-align: right;">4.80</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">5000</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: left;">t3</td>
<td style="text-align: right;">4.08</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">5000</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: left;">t1</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">5000</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: left;">t2</td>
<td style="text-align: right;">1.68</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">5000</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: left;">t1</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">5000</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp2</td>
<td style="text-align: left;">t2</td>
<td style="text-align: right;">3.24</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">5000</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp3</td>
<td style="text-align: left;">t3</td>
<td style="text-align: right;">3.72</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">5000</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: left;">t4</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">5000</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp5</td>
<td style="text-align: left;">t5</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">5000</td>
<td style="text-align: right;">0.5</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="compute-equations" class="level1">
<h1>2. Compute Equations</h1>
<p>Note all four equations that follow derive estimates according to specific species, whether measured at the plot level, stratum or globally. Hence, caution is advised when computing initial, absolute estimates and when deriving or applying hectare expansion factors.</p>
<p>On page 19 of <a href="https://verra.org/wp-content/uploads/2024/10/VM0010_IFM_LtPF_v1.4_Clean_10282024.pdf">VM0010 Methodology</a>, ‘equation 1’ calculates merchantable timber volume in cubic meters using the following:</p>
<section id="eq1-plot-biomass" class="level4">
<h4 class="anchored" data-anchor-id="eq1-plot-biomass">EQ1: Plot biomass</h4>
<p><span class="math display">\[V_{j,i|sp} = \sum_{l = 1}^{L} V_{l,j,i,sp}\]</span></p>
<p>where <span class="math inline">\(V_{j,i|sp}\)</span> refers to the sum of merchantable volume of species <em>j</em> from plot <em>sp</em> in stratum <em>i,</em> as computed in the following.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dataset_tidy <span class="ot">=</span> dataset_tidy <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species_j, stratum_i, plot_sp) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vji_sp_m3 =</span> <span class="fu">sum</span>(volume))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute new variable 'vji_sp_m3'</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(dataset_tidy)[, .(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">vji_sp_m3 =</span> <span class="fu">sum</span>(volume)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(stratum_i, plot_sp, species_j)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>] <span class="sc">|&gt;</span> <span class="fu">kbl</span>() <span class="sc">|&gt;</span> <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">stratum_i</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">plot_sp</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">species_j</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">vji_sp_m3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">3.18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">1.38</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp2</td>
<td style="text-align: right;">3.24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp3</td>
<td style="text-align: right;">3.72</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">2.94</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sp5</td>
<td style="text-align: right;">3.36</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="eq2-strata-biomass" class="level4">
<h4 class="anchored" data-anchor-id="eq2-strata-biomass">EQ2: Strata biomass</h4>
<p>On page 19 of the VM0010 Methodology, ‘equation 2’ provides calculation of merchantable timber volume of a species at the stratum level:</p>
<p><span class="math display">\[V_{j,i|BSL} = \displaystyle \frac{1}{SP} \sum_{sp=1}^{sp} \displaystyle \frac{V_{j,i,sp}}{A_{sp}}\]</span></p>
<p>where <span class="math inline">\(V_{j,i|BSL}\)</span> refers to the <u><strong><em>mean</em></strong></u> merchantable timber volume of species <em>j</em> measured across all plots within stratum <em>i</em> in the baseline scenario. Volume estimates are derived in terms of m<sup>3</sup>/ha<sup>-1</sup> using an expansion factor derived as the ratio of plot area 1,000m<sup>2</sup> to 10,000m<sup>2</sup>, as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dataset_tidy <span class="ot">=</span> dataset_tidy <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stratum_i, species_j) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vji_ha_m3 =</span> <span class="fu">mean</span>(vji_sp_m3) <span class="sc">*</span> <span class="dv">10</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(dataset_tidy)[, .(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  vji_sp_m3,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  vji_ha_m3</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(stratum_i, species_j)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>] <span class="sc">|&gt;</span> <span class="fu">kbl</span>() <span class="sc">|&gt;</span> <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">stratum_i</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">species_j</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">vji_sp_m3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">vji_ha_m3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">31.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">31.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">13.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp2</td>
<td style="text-align: right;">3.24</td>
<td style="text-align: right;">32.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp3</td>
<td style="text-align: right;">3.72</td>
<td style="text-align: right;">37.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">29.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp5</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">33.6</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="eq3-harvest-carbon" class="level4">
<h4 class="anchored" data-anchor-id="eq3-harvest-carbon">EQ3: Harvest carbon</h4>
<p>On page 20 of the VM0010 Methodology, ‘equation 3’ provides calculation of carbon stock of harvested timber volumes for species <em>i</em> in stratum <em>i</em>.</p>
<p>In the absence of harvest plan data, carbon stocks of commercial timber will be derived from the full inventory <code>dataset_tidy</code>.</p>
<p>This differs to ‘equation 3’ below, which measures mean carbon stock from volumes of ‘harvested biomass’ <span class="math inline">\(C_{HB,j,i|BSL}\)</span> comprised of volumes estimates from extracted timber that is destined off-site for market sales, in addition to volume estimates from extracted timber that is remaining on-site due to damage or use during site operations and road construction. The difference in destinations of these carbon stocks means that alternative carbon factors must be applied in their calculation, as indicated in following two equations</p>
<p><span class="math display">\[C_{HB,j,i|BSL} = (V_{EX,j,i|BSL} + V_{EX,INF,j,i|BSL} ) * BCEF_{R} * CF_{j}\]</span></p>
<p>Carbon estimates are calculated in units of metric tons per hectare (tC/ha<sup>-1</sup>) by multiplying mean volume per hectare of extracted timber of species <em>i</em> from stratum <em>j</em> by the carbon fraction <span class="math inline">\(CF\)</span> (default = 0.5) and biomass conversion and expansion factor <span class="math inline">\(BCEF_{R}\)</span> of that species. If needed, VM0010 methoodology provides guidance on approriate literature source for defining CF with prioritiy of local forest types over national and regional forest types, over forest types from neighboring countries. However, if defaulting to global forest type values, recommendations point to chapter four of <span class="citation" data-cites="krey1Chapter4">(<a href="#ref-krey1Chapter4" role="doc-biblioref">Krey et al., n.d.</a>)</span> that cite value of 1.11. We rely on the provided value of 0.7.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dataset_tidy <span class="ot">&lt;-</span> dataset_tidy <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chb_ha_tC =</span> vji_ha_m3 <span class="sc">*</span> bcef_r <span class="sc">*</span> cf)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(dataset_tidy)[, .(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  vji_sp_m3,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  vji_ha_m3,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  chb_ha_tC</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(stratum_i, species_j)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>] <span class="sc">|&gt;</span> <span class="fu">kbl</span>() <span class="sc">|&gt;</span> <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">stratum_i</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">species_j</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">vji_sp_m3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">vji_ha_m3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">chb_ha_tC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
<td style="text-align: right;">42.63</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
<td style="text-align: right;">42.63</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
<td style="text-align: right;">42.63</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: right;">11.13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: right;">11.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">13.8</td>
<td style="text-align: right;">4.83</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp2</td>
<td style="text-align: right;">3.24</td>
<td style="text-align: right;">32.4</td>
<td style="text-align: right;">11.34</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp3</td>
<td style="text-align: right;">3.72</td>
<td style="text-align: right;">37.2</td>
<td style="text-align: right;">13.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">29.4</td>
<td style="text-align: right;">10.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp5</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">33.6</td>
<td style="text-align: right;">11.76</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="eq4-extracted-carbon" class="level4">
<h4 class="anchored" data-anchor-id="eq4-extracted-carbon">EQ4: Extracted carbon</h4>
<p>“Not all of the harvested biomass leaves the forest because the timber harvested has two components: 1) wood removed to market (extracted timber) and 2) wood remaining in the forest as a result of harvest” (VM0010, 2024:21).</p>
<p>To account for all harvest removals, ‘equation 4’ computes mean carbon of species <em>i</em> in stratum <em>j</em> by adding mean timber to market (<span class="math inline">\(V_{EX,j,i|BSL}\)</span>) and mean timber used in harvest infrastructure (<span class="math inline">\(V_{EX,INF,j,i|BSL}\)</span>). This sum is then multiplied by the wood density <span class="math inline">\(D\)</span> and carbon fraction <span class="math inline">\(CF\)</span> of that species and reported in units of tC.ha<sup>-1</sup> using the following formula:</p>
<p><span class="math display">\[C_{EX,j,i|BSL} = (V_{EX,j,i|BSL} + V_{EX,INF,j,i|BSL} ) * D_{j} * CF_{j}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dataset_tidy <span class="ot">&lt;-</span> dataset_tidy <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cex_ha_tC =</span> vji_ha_m3 <span class="sc">*</span> d <span class="sc">*</span> cf)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(dataset_tidy)[, .(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  vji_sp_m3,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  vji_ha_m3,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  chb_ha_tC,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  cex_ha_tC</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(stratum_i, species_j)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>] <span class="sc">|&gt;</span> <span class="fu">kbl</span>() <span class="sc">|&gt;</span> <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">stratum_i</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">species_j</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">vji_sp_m3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">vji_ha_m3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">chb_ha_tC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cex_ha_tC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
<td style="text-align: right;">42.63</td>
<td style="text-align: right;">30.45</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
<td style="text-align: right;">42.63</td>
<td style="text-align: right;">30.45</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
<td style="text-align: right;">42.63</td>
<td style="text-align: right;">30.45</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: right;">11.13</td>
<td style="text-align: right;">7.95</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: right;">11.13</td>
<td style="text-align: right;">7.95</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">13.8</td>
<td style="text-align: right;">4.83</td>
<td style="text-align: right;">3.45</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp2</td>
<td style="text-align: right;">3.24</td>
<td style="text-align: right;">32.4</td>
<td style="text-align: right;">11.34</td>
<td style="text-align: right;">8.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp3</td>
<td style="text-align: right;">3.72</td>
<td style="text-align: right;">37.2</td>
<td style="text-align: right;">13.02</td>
<td style="text-align: right;">9.30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">29.4</td>
<td style="text-align: right;">10.29</td>
<td style="text-align: right;">7.35</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp5</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">33.6</td>
<td style="text-align: right;">11.76</td>
<td style="text-align: right;">8.40</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="eq5-slash-carbon" class="level4">
<h4 class="anchored" data-anchor-id="eq5-slash-carbon">EQ5: Slash carbon</h4>
<p><span class="math display">\[∆C_{DWSLASH_,i,p|BSL} = \sum_{i=1}^{j} \space [C_{HB,j,i|BSL} - C_{EX,j,i|BSL} + C_{RSD,j,i|BSL} + C_{notHB,inf,j,i|BSL}]\]</span></p>
<p>Equation 5 computes carbon change produced by slash as “the difference between the total carbon stock of the harvested biomass and the carbon stock of the extracted timber, plus the residual stand damage and biomass of trees left to decay as a result forestry infrastructure establishment”. Specifically, values of <span class="math inline">\(C_{notHB,inf,j,i|BSL}\)</span> are computed by applying a fractional value of timber used in harvesting infrastructure development (<span class="math inline">\(F_{V,INF,HWP}\)</span>), which may be provided by project proponent, and if missing will be conservatively assumed as 0.0%.</p>
</section>
<section id="eq6-damaged-carbon" class="level4">
<h4 class="anchored" data-anchor-id="eq6-damaged-carbon">EQ6: Damaged carbon</h4>
<p><span class="math inline">\(C_{RSD,j,i\|BSL}\)</span> is defined in units of tC·ha<sup>-1</sup> as mean carbon change from residual stand damage as computed in the following:</p>
<p><span class="math display">\[C_{RSD,j,i\|BSL} = C_{EX,j,i|BSL} \times F_{RSD|BSL}\]</span> where <span class="math inline">\(F_{RSD|BSL}\)</span> represents a dimensionless value for the factor of “residual stand damage” per species in that area. On page 56 of the VM0010 document, an example reference is cited for sourcing residual stand damage values <span class="citation" data-cites="winjum1998">(<a href="#ref-winjum1998" role="doc-biblioref">Winjum, Brown, and Schlamadinger 1998</a>)</span>. We apply the reported value of Congo operations of 1.74 t compute the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dataset_tidy <span class="ot">=</span> dataset_tidy <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f_rsd =</span> <span class="fl">1.74</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>dataset_tidy <span class="ot">=</span> dataset_tidy <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">c_rsd =</span> cex_ha_tC <span class="sc">*</span> f_rsd)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(dataset_tidy)[, .(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  vji_sp_m3,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  vji_ha_m3,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  chb_ha_tC,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  c_rsd</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(stratum_i, species_j)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>] <span class="sc">|&gt;</span> <span class="fu">kbl</span>() <span class="sc">|&gt;</span> <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">stratum_i</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">species_j</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">vji_sp_m3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">vji_ha_m3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">chb_ha_tC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">c_rsd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
<td style="text-align: right;">42.63</td>
<td style="text-align: right;">52.983</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
<td style="text-align: right;">42.63</td>
<td style="text-align: right;">52.983</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">121.8</td>
<td style="text-align: right;">42.63</td>
<td style="text-align: right;">52.983</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: right;">11.13</td>
<td style="text-align: right;">13.833</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: right;">11.13</td>
<td style="text-align: right;">13.833</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp1</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">13.8</td>
<td style="text-align: right;">4.83</td>
<td style="text-align: right;">6.003</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp2</td>
<td style="text-align: right;">3.24</td>
<td style="text-align: right;">32.4</td>
<td style="text-align: right;">11.34</td>
<td style="text-align: right;">14.094</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp3</td>
<td style="text-align: right;">3.72</td>
<td style="text-align: right;">37.2</td>
<td style="text-align: right;">13.02</td>
<td style="text-align: right;">16.182</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp4</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">29.4</td>
<td style="text-align: right;">10.29</td>
<td style="text-align: right;">12.789</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Sp5</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">33.6</td>
<td style="text-align: right;">11.76</td>
<td style="text-align: right;">14.616</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="eq7-undamaged-carbon" class="level4">
<h4 class="anchored" data-anchor-id="eq7-undamaged-carbon">EQ7: Undamaged carbon</h4>
<p>Equation 7 computes mean carbon volume of biomass that was <strong>not</strong> extracted during the construction of harvest infrastructure as follows:</p>
<p><span class="math display">\[C_{notHB,inf,j,i|BSL} = V_{notEX,inf,j,i|BSL} \times BCEF_R \times CF_j\]</span></p>
</section>
<section id="eq8-wood-products" class="level4">
<h4 class="anchored" data-anchor-id="eq8-wood-products">EQ8: Wood products</h4>
<p>Sampling criteria indicate that carbon of wood products is quantified in terms of its volume at time of harvest, while applying conversion factors provided in Winjum et al <a href="https://academic.oup.com/forestscience/article/44/2/272/4626952">(1998)</a>:</p>
<p><span class="math display">\[C_{EX,i|BSL} = \sum_{j=1}^{J} C_{EX,j,i|BSL}\]</span></p>
<p>At this stage, It is advised to assign gross percentages of volume extracted to wood product classes on the basis of local expert knowledge of harvest activities and markets. Wood product classes may include <code>sawnwood</code>, <code>panels</code>, <code>roundwood</code>, <code>paper</code>, etc. In addition, the amount of carbon stored in wood products that would decay within three years after harvest are assumed to be emitted at the time of harvest</p>
</section>
<section id="eq9-hwp-carbon-loss-year-0" class="level4">
<h4 class="anchored" data-anchor-id="eq9-hwp-carbon-loss-year-0">EQ9: HWP carbon loss <sup>year-0</sup></h4>
<p>Equation 9 calculates mean carbon immediately emmited from harvested volumes at the time of harvest, as follows:</p>
<p><span class="math display">\[
∆C_{WP0,i|BSL} = \sum  \space (C_{EX,i,k|BSL} \times WW_k + SLF_k)
\]</span></p>
<p>where input variables <span class="math inline">\(SLF_f\)</span> and <span class="math inline">\(WW_k\)</span> are derived as the fraction of carbon immediately emitted from specific short-lived wood products, and the fraction of carbon immediately emitted from wood waste, respectively.</p>
</section>
<section id="eq10-hwp-carbon-store" class="level4">
<h4 class="anchored" data-anchor-id="eq10-hwp-carbon-store">EQ10: HWP carbon store</h4>
<p>Alternatively, equation 10 computes mean carbon not immediately emitted from harvest volumes at the time of harvest (year=0), as follows:</p>
<p><span class="math display">\[
C_{WP,i|BSL} = \sum \space (C_{EX,i,k|BSL} - ∆C_{WP0,i|BSL})
\]</span></p>
</section>
<section id="eq11-hwp-carbon-loss-year-100" class="level4">
<h4 class="anchored" data-anchor-id="eq11-hwp-carbon-loss-year-100">EQ11: HWP carbon loss <sup>year-100</sup></h4>
<p>Equation 11 computes carbon stored in wood products that are assumed to be retired between 3 - 100 years after harvest from stratum i in land parcel <em>p</em> (tC ha<sup>-1</sup>), where <span class="math inline">\(OF_k\)</span> provides the fraction of biomass carbon for wood product type <em>k</em> that is assumed to be emitted to the atmosphere between 3 and 100 years of timber harvest. <span class="citation" data-cites="winjum1998">Winjum, Brown, and Schlamadinger (<a href="#ref-winjum1998" role="doc-biblioref">1998</a>)</span> gives annual oxidation fractions for each class of wood products split by forest region (boreal, temperate and tropical), which is estimated to provide the fraction of carbon that is oxidized between the 3rd and the 100th year after initial harvest, as follows:</p>
<p><span class="math display">\[
∆C_{WP100,i,p|BSL} = \sum \space (C_{WP,i|BSL} \times OF_k)
\]</span></p>
<p>where <span class="math inline">\(OF_k\)</span> is defined in VM0010 documentation as the fraction of biomass carbon per product type <em><code>k</code></em> that is emitted to atmosphere in 100 years following timber harvest:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="R/assets/OF-VM0010.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></p>
</figure>
</div>
</section>
<section id="eq12-fuel-emissions" class="level4">
<h4 class="anchored" data-anchor-id="eq12-fuel-emissions">EQ12: Fuel emissions</h4>
<p>Total fuel emissions are derived from all sources presented in Table 2 on page 12 of [VM0010](<a href="https://verra.org/wp-content/uploads/2024/10/VM0010_IFM_LtPF_v1.4_Clean_10282024.pdf" class="uri">https://verra.org/wp-content/uploads/2024/10/VM0010_IFM_LtPF_v1.4_Clean_10282024.pdf</a>). Specific emissions variables are defined in subsequent equations:</p>
<p><span class="math display">\[C_{FUEL} = \frac{E_{HARVEST} + E_{HAULING} + E_{TRANSPORT} + E_{PROCESSING}} {\frac{44}{12}}\]</span></p>
</section>
<section id="eq13-harvesting-fuel-emissions" class="level4">
<h4 class="anchored" data-anchor-id="eq13-harvesting-fuel-emissions">EQ13: Harvesting fuel emissions</h4>
<p><span class="math display">\[
E_{HARVEST} = FC_{HARVEST} \times EF_{FUEL} \times \sum_{j,i,p} \space V_{EX,j,i|BSL} \times A_i
\]</span></p>
<p>where <span class="math inline">\(FC_{HARVEST}\)</span> derives volume of fuel consumed by harvest operators per m<sup>3</sup> of extracted log (kL/m<sup>-3</sup>) and <span class="math inline">\(EF_{FUEL}\)</span> represents a fuel emission factor (tCO2<sub>e</sub> kL<sup>-1</sup>). These input variables must be derived through the common practice pathway method. The following sources of information are permitted for this: • Data from other forest management companies in the region; or • Data from peer reviewed literature (or published by government agency)</p>
</section>
<section id="eq14-hauling-fuel-emissions" class="level4">
<h4 class="anchored" data-anchor-id="eq14-hauling-fuel-emissions">EQ14: Hauling fuel emissions</h4>
<p><span class="math display">\[
E_{HAULING} = FC_{HAULING} \times EF_{FUEL} \times V{EX,j,i|BSL} \times A_i
\]</span></p>
</section>
<section id="eq15-transport-fuel-emissions" class="level4">
<h4 class="anchored" data-anchor-id="eq15-transport-fuel-emissions">EQ15: Transport fuel emissions</h4>
<p><span class="math display">\[
N_{TRUCKS-TRANSPORT} = \frac{\sum_{j,i} V_{EX,j,i|BSL} \times A_i}{CAP_{TRUCK}}\]</span></p>
</section>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<section id="a.1-datamaid-audit" class="level3">
<h3 class="anchored" data-anchor-id="a.1-datamaid-audit">A.1 DataMaid audit</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">includeHTML</span>(<span class="st">"dataMaid_dataset_tidy.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="R/assets/dataMaid_dataset_tidy.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.4.2 Patched (2024-11-18 r87347)
 os       macOS Sequoia 15.1.1
 system   aarch64, darwin20
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/Vancouver
 date     2024-11-29
 pandoc   3.5 @ /usr/local/bin/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package      * version  date (UTC) lib source
 animation    * 2.7      2021-10-07 [1] CRAN (R 4.4.0)
 assertthat     0.2.1    2019-03-21 [1] CRAN (R 4.4.0)
 BIOMASS      * 2.1.11   2023-09-29 [1] CRAN (R 4.4.0)
 cachem         1.1.0    2024-05-16 [1] CRAN (R 4.4.0)
 cellranger     1.1.0    2016-07-27 [1] CRAN (R 4.4.0)
 class          7.3-22   2023-05-03 [1] CRAN (R 4.4.2)
 classInt       0.4-10   2023-09-05 [1] CRAN (R 4.4.0)
 cli            3.6.3    2024-06-21 [1] CRAN (R 4.4.0)
 codetools      0.2-20   2024-03-31 [1] CRAN (R 4.4.2)
 colorspace     2.1-1    2024-07-26 [1] CRAN (R 4.4.0)
 data.table     1.16.2   2024-10-10 [1] CRAN (R 4.4.1)
 dataMaid     * 1.4.1    2021-10-08 [1] CRAN (R 4.4.0)
 DBI            1.2.3    2024-06-02 [1] CRAN (R 4.4.0)
 DEoptimR       1.1-3-1  2024-11-23 [1] CRAN (R 4.4.1)
 devtools       2.4.5    2022-10-11 [1] CRAN (R 4.4.0)
 digest         0.6.37   2024-08-19 [1] CRAN (R 4.4.1)
 dplyr        * 1.1.4    2023-11-17 [1] CRAN (R 4.4.0)
 e1071          1.7-16   2024-09-16 [1] CRAN (R 4.4.1)
 easypackages   0.1.0    2016-12-05 [1] CRAN (R 4.4.0)
 ellipsis       0.3.2    2021-04-29 [1] CRAN (R 4.4.0)
 evaluate       1.0.1    2024-10-10 [1] CRAN (R 4.4.1)
 extrafont    * 0.19     2023-01-18 [1] CRAN (R 4.4.0)
 extrafontdb    1.0      2012-06-11 [1] CRAN (R 4.4.0)
 fansi          1.0.6    2023-12-08 [1] CRAN (R 4.4.0)
 fastmap        1.2.0    2024-05-15 [1] CRAN (R 4.4.0)
 forcats        1.0.0    2023-01-29 [1] CRAN (R 4.4.0)
 fs             1.6.5    2024-10-30 [1] CRAN (R 4.4.1)
 generics       0.1.3    2022-07-05 [1] CRAN (R 4.4.0)
 ggplot2        3.5.1    2024-04-23 [1] CRAN (R 4.4.0)
 glue           1.8.0    2024-09-30 [1] CRAN (R 4.4.1)
 gridExtra      2.3      2017-09-09 [1] CRAN (R 4.4.0)
 gtable         0.3.6    2024-10-25 [1] CRAN (R 4.4.1)
 haven          2.5.4    2023-11-30 [1] CRAN (R 4.4.0)
 hms            1.1.3    2023-03-21 [1] CRAN (R 4.4.0)
 htmltools    * 0.5.8.1  2024-04-04 [1] CRAN (R 4.4.0)
 htmlwidgets    1.6.4    2023-12-06 [1] CRAN (R 4.4.0)
 httpuv         1.6.15   2024-03-26 [1] CRAN (R 4.4.0)
 janitor      * 2.2.0    2023-02-02 [1] CRAN (R 4.4.0)
 jsonlite       1.8.9    2024-09-20 [1] CRAN (R 4.4.1)
 kableExtra   * 1.4.0    2024-01-24 [1] CRAN (R 4.4.0)
 KernSmooth     2.23-24  2024-05-17 [1] CRAN (R 4.4.2)
 knitr        * 1.49     2024-11-08 [1] CRAN (R 4.4.1)
 later          1.4.1    2024-11-27 [1] CRAN (R 4.4.1)
 lifecycle      1.0.4    2023-11-07 [1] CRAN (R 4.4.0)
 lubridate      1.9.3    2023-09-27 [1] CRAN (R 4.4.0)
 magrittr       2.0.3    2022-03-30 [1] CRAN (R 4.4.0)
 memoise        2.0.1    2021-11-26 [1] CRAN (R 4.4.0)
 mime           0.12     2021-09-28 [1] CRAN (R 4.4.0)
 miniUI         0.1.1.1  2018-05-18 [1] CRAN (R 4.4.0)
 minpack.lm     1.2-4    2023-09-11 [1] CRAN (R 4.4.0)
 munsell        0.5.1    2024-04-01 [1] CRAN (R 4.4.0)
 pander         0.6.5    2022-03-18 [1] CRAN (R 4.4.0)
 pillar         1.9.0    2023-03-22 [1] CRAN (R 4.4.0)
 pkgbuild       1.4.5    2024-10-28 [1] CRAN (R 4.4.1)
 pkgconfig      2.0.3    2019-09-22 [1] CRAN (R 4.4.0)
 pkgload        1.4.0    2024-06-28 [1] CRAN (R 4.4.0)
 profvis        0.4.0    2024-09-20 [1] CRAN (R 4.4.1)
 promises       1.3.2    2024-11-28 [1] CRAN (R 4.4.1)
 proxy          0.4-27   2022-06-09 [1] CRAN (R 4.4.0)
 purrr          1.0.2    2023-08-10 [1] CRAN (R 4.4.0)
 R6             2.5.1    2021-08-19 [1] CRAN (R 4.4.0)
 rappdirs       0.3.3    2021-01-31 [1] CRAN (R 4.4.0)
 Rcpp           1.0.13-1 2024-11-02 [1] CRAN (R 4.4.1)
 readxl       * 1.4.3    2023-07-06 [1] CRAN (R 4.4.0)
 remotes        2.5.0    2024-03-17 [1] CRAN (R 4.4.0)
 rlang          1.1.4    2024-06-04 [1] CRAN (R 4.4.0)
 rmarkdown      2.29     2024-11-04 [1] CRAN (R 4.4.1)
 robustbase     0.99-4-1 2024-09-27 [1] CRAN (R 4.4.1)
 rstudioapi     0.17.1   2024-10-22 [1] CRAN (R 4.4.1)
 Rttf2pt1       1.3.12   2023-01-22 [1] CRAN (R 4.4.0)
 scales         1.3.0    2023-11-28 [1] CRAN (R 4.4.0)
 sessioninfo    1.2.2    2021-12-06 [1] CRAN (R 4.4.0)
 sf             1.0-19   2024-11-05 [1] CRAN (R 4.4.1)
 shiny          1.9.1    2024-08-01 [1] CRAN (R 4.4.0)
 snakecase      0.11.1   2023-08-27 [1] CRAN (R 4.4.0)
 stringi        1.8.4    2024-05-06 [1] CRAN (R 4.4.0)
 stringr        1.5.1    2023-11-14 [1] CRAN (R 4.4.0)
 svglite        2.1.3    2023-12-08 [1] CRAN (R 4.4.0)
 systemfonts    1.1.0    2024-05-15 [1] CRAN (R 4.4.0)
 terra          1.7-78   2024-05-22 [1] CRAN (R 4.4.0)
 tibble         3.2.1    2023-03-20 [1] CRAN (R 4.4.0)
 tidyselect     1.2.1    2024-03-11 [1] CRAN (R 4.4.0)
 timechange     0.3.0    2024-01-18 [1] CRAN (R 4.4.0)
 tinytex      * 0.54     2024-11-01 [1] CRAN (R 4.4.1)
 units          0.8-5    2023-11-28 [1] CRAN (R 4.4.0)
 urlchecker     1.0.1    2021-11-30 [1] CRAN (R 4.4.0)
 usethis        3.1.0    2024-11-26 [1] CRAN (R 4.4.1)
 utf8           1.2.4    2023-10-22 [1] CRAN (R 4.4.0)
 vctrs          0.6.5    2023-12-01 [1] CRAN (R 4.4.0)
 viridisLite    0.4.2    2023-05-02 [1] CRAN (R 4.4.0)
 xfun           0.49     2024-10-31 [1] CRAN (R 4.4.1)
 xml2           1.3.6    2023-12-04 [1] CRAN (R 4.4.0)
 xtable         1.8-4    2019-04-21 [1] CRAN (R 4.4.0)
 yaml           2.3.10   2024-07-26 [1] CRAN (R 4.4.0)

 [1] /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-krey1Chapter4" class="csl-entry" role="listitem">
Krey, Volker, Hans Lofgren, Toshihiko Masui, Ritu Mathur, Joana Portugal Pereira, Benjamin Kenneth Sovacool, Maria Virginia Vilariño, et al. n.d. <span>“1 Chapter 4: Mitigation and Development Pathways in the 2 Near- to Mid-Term.”</span>
</div>
<div id="ref-winjum1998" class="csl-entry" role="listitem">
Winjum, Jack K., Sandra Brown, and Bernhard Schlamadinger. 1998. <span>“Forest Harvests and Wood Products: Sources and Sinks of Atmospheric Carbon Dioxide.”</span> <em>Forest Science</em> 44 (2): 272–84. <a href="https://doi.org/10.1093/forestscience/44.2.272">https://doi.org/10.1093/forestscience/44.2.272</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>